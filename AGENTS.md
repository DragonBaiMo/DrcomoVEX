# 开发规则（采用 Win11/Powershell）

> **作者：BaiMo_**  
> **开发理念关键词：第一性原理 / DRY / KISS / SOLID / YAGNI**  
> **目标：保持清晰沟通、可扩展架构、安全可控、代码高质、维护高效**

---

## 一、沟通与需求确认规则

1. **统一语言规范**
   所有沟通内容、注释、日志输出及生成内容，**一律使用中文**进行表达，严禁混用其他语言。
2. **外部资源使用边界**
   凡我未明确提供或指定的接口、API、库文件或外部资源，**仅允许基于公开文档或明确说明进行调用**；
   禁止使用**反射、动态拼接、模糊推测等方式构造调用路径或方法名**，以防绕过语义校验导致隐性错误。
3. **不确定行为处理机制**
   凡遇以下任一情况，必须遵循“确认优先”原则，**不得擅自执行或构造替代逻辑**，应按以下流程处理：
   * **情境类型**：接口未提供、参数不明、调用失败、报错信息未知、文档缺失或需求含糊；
   * **处理流程**：
     1. 尝试调用 MCP Server 或搜索工具，获取可验证的调用方式；
     2. 无法解决时，应**向我明确提出问题**，并提供已尝试的上下文与返回信息；
     3. 若问题暂不可解，**标注为 `TODO` 并附原因说明**，不得继续执行或跳过逻辑。

---

## 二、设计规划与架构原则

1. **设计先行**：复杂逻辑/新功能开发前，务必先进行功能规划，可使用 `sequential-thinking`。
2. **模块清晰职责单一**：遵循 **SRP**，将指令处理、监听、配置、逻辑等分开设计。
3. **从领域抽象出核心接口**：坚持“第一性原理”，代码以业务模型与接口驱动结构演进。
4. **可扩展性优先**：
   * 所有可拓展逻辑须基于接口/抽象类；
   * 新功能开发前先排查已有代码，优先复用或扩展。
5. **五大开发原则嵌入设计层**：
   * **DRY**：禁止复制粘贴逻辑，抽取公共方法；
   * **KISS**：代码保持简洁直观；
   * **SOLID**：接口隔离、单一职责、依赖倒置等设计准则；
   * **YAGNI**：只做当前所需，避免预设未使用的未来扩展。
6. **方法/类建议控制在 30~200 行**；单文件超500行需拆分子模块，**并附文档注释**。
7. **复杂项目建议采用明确的目录结构与分层职责**（如：`domain/`, `service/`, `repository/`, `controller/`），保持可读性与扩展性。

---

## 三、编码规范与质量控制

1. **命名统一规范**：变量、方法、类名需**清晰表达语义，命名具有业务意义**，遵循代码命名风格。
2. **格式化 & 静态分析工具必须启用**，保持风格统一、避免潜在语法错误。
3. **注释规范**：
   * 所有公共 API、暴露方法需具备完整文档（含描述、参数、返回值、异常）；
   * **所有公共类与接口必须使用 JavaDoc 标准格式注释，说明用途、参数、返回、异常等信息**；
   * 复杂逻辑必须说明“为何如此”，而非仅描述“做了什么”。
4. **禁止重复造轮子**：写代码前，必须检查项目是否已有类似功能，复用为首选；不可重复实现同类逻辑。
5. **合并写入，避免刷屏**：
   同一文件中修改应最大程度上采用一次性写完相关多行，避免一行行提交;除非因内容过长或交互确认，否则不得碎片输出。
6. **导包推迟或随用**：
   禁止先集中导入所有包。应在写逻辑时同步导包，或写完再统一整理导入区，避免多余导入。
7. **禁止硬编码可修改内容**  
   禁止将用户可自定义的内容以硬编码形式写入代码。配置文件加载逻辑应具备判断机制：仅在未检测到用于存放配置文件的目录时，才自动创建该目录并复制文件夹里的所有示例配置文件进入，避免强制注入。
8. **示例配置文件需实时同步**  
   所有涉及读取配置文件内容的功能，必须同步创建或更新对应的示例配置文件，以便我实时追踪配置结构与参数变更，确保示例文件始终与实际逻辑保持一致。

---

## 四、异步任务与性能控制

1. **异步使用评估优先**：
   * 对耗时的 IO、网络、计算等，应优先异步；
   * 异步前需分析是否会引发线程安全、竞态条件问题。
2. **主线程状态更新必须安全回调**；无法保证线程安全时，应使用同步处理，并明确说明理由。
3. **异步逻辑需做异常保护与降级处理**，避免主流程失控。

---

## 五、安全性要求

1. **输入验证严谨**：
   * 禁止信任任何外部输入；
   * 严格检查输入格式、长度、类型、范围；
   * 使用白名单策略。
2. **敏感信息保护**：
   * 密码、密钥需加密或加盐存储；
   * 日志和配置文件中严禁暴露敏感内容。
3. **权限控制原则**：
   * 所有敏感操作前均需权限判断；
   * 权限配置遵循“最小权限”原则。
4. **防护要点**：明确防范 SQL/命令注入、路径遍历、XSS、DoS 等典型漏洞。

---

## 六、数据与资源管理规范

1. **持久化逻辑统一**：
   * 所有数据处理先在内存执行，再按策略统一写入；
   * 数据库操作必须采用参数化查询，禁止拼接 SQL。
2. **资源释放规范**：
   * 文件、数据库连接、Socket 等必须在使用后主动释放；
   * 推荐使用连接池统一管理长连接资源。

---

## 七、自定义配置与国际化支持

1. **用户界面内容、提示语**必须支持配置文件化，便于多语言切换和自定义。
2. **所有提示信息禁止硬编码**，必须提取至配置文件或本地化资源中。

---

## 八、日志、调试与错误处理

1. **关键路径需添加中文日志**：如状态变更、异常捕捉、重要分支逻辑。
2. **日志内容不得包含敏感数据**，避免泄漏问题。
3. **调试日志需分级处理**，便于问题定位与上线控制。

---

## 九、开发中待办管理

1. 所有以下情况**必须添加 `// TODO` 注释**标记待办：
   * 功能暂未实现；
   * 临时方案/模拟逻辑/占位实现；
   * 存在待优化的性能或设计；
   * 已知问题待后续修复。
   * 等待后续扩展
1. TODO 注释需明确说明“本次目的+处理思路”。

---

## ✅ 最终原则总结

> **始终贯彻五大核心理念**：  
> **第一性原理：** 从本质建模抽象接口；  
> **DRY：** 绝不重复；  
> **KISS：** 保持简洁；  
> **SOLID：** 单一职责、接口隔离、依赖倒置；  
> **YAGNI：** 不做没用的提前设计。

**以清晰沟通为前提、以规划优先为核心、以安全可靠为底线、以可维护可扩展为目标。**
