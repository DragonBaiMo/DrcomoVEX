# 📘 DrcomoVex 全新版本 - 最终用户使用手册

> **你好，服主。**
>
> 欢迎来到一个**懂你所需，随你所想**的变量系统。
>
> DrcomoVex 的设计，旨在将强大的功能，蕴藏于极致的简洁之中。它足够智能，能从你的配置中读懂你的意图；它也足够严谨，能在你需要时提供明确的规则约束。

.

> 这里没有冗余的废话，只有直达目的的效率。无论你是想快速实现一个想法，还是精雕细琢一个复杂的系统，DrcomoVex 都将是你最得心应手的工具。
>
> 本手册将引导你释放它的全部潜力。

-----

### 📄 1. 功能简介

DrcomoVex 是一款次世代的、**基于直觉设计**的服务器变量管理系统。它能让你通过极其简洁的配置，实现动态、智能、高度灵活的游戏玩法。

  * **核心功能**:

      * **智能类型推断与可选定义**：插件会根据你的配置自动推断变量的行为，你也可以使用 `type` 字段进行精确定义，在灵活性与规范性之间取得完美平衡。
      * **强大的“全能”指令**：核心指令如 `/vex add` 不仅能进行数学运算，更能直接使用占位符进行动态增减，极大增强了指令的威力。
      * **万物皆可动态**：所有关键配置项（如 `initial`, `min`, `max`）均支持 PlaceholderAPI 占位符和内部变量引用，让你的服务器规则真正“活”起来。
      * **极致简洁的配置**：以最少的文字，实现最强大的功能，告别一切不必要的复杂性。

  * **它能帮你做什么**:

      * 轻松创建每日/每周/每月自动重置的任务或积分。
      * 设计一个值会根据玩家等级、金币、服务器TPS实时变化的“动态战斗力”。
      * 灵活地管理玩家的称号列表、好友黑名单等。
      * 以前所未有的简单方式，构建出复杂且有趣的服务器经济和玩法系统。

-----

### 🚀 2. 功能入口说明

与 DrcomoVex 交互的唯一入口，就是 `/vex` 指令。它简单，且功能强大。

  * **核心指令**: `/vex`
  * **别名**: `/dvex`, `/drcomo`
  * **使用方式**: 在游戏聊天栏或服务器控制台输入 `/vex`，并跟上相应的**子命令**和**参数**来执行具体操作。例如，获取帮助：`/vex help`。

-----

### 🧮 3. 操作流程详解

DrcomoVex 的指令系统足够智能，能理解你的操作意图，并支持占位符，让指令本身也具备动态能力。

#### **3.1 核心参数**

  * `<变量名>` (必需): 你要操作的变量的ID。
  * `<值>` (可选): 你要设置或操作的值。
  * `-p:<玩家ID>` (可选): 指定操作的目标玩家。**如果省略，默认对指令输入者生效。**

#### **3.2 获取变量 (`get`)**

查看一个变量的当前值。

  * **指令格式**: `/vex get <变量名> [-p:<玩家ID>]`
  * **示例**:
      * 查看你自己的金币: `/vex get player_money`
      * 查看玩家 `Notch` 的等级: `/vex get player_level -p:Notch`
  * **智能之处**: 如果获取的是一个包含占位符的变量，系统会**实时解析**并返回当前最新的值。

#### **3.3 设置变量 (`set`)**

**强制覆盖**一个变量的当前值。这是最直接、最原始的修改方式。

  * **指令格式**: `/vex set <变量名> <值> [-p:<玩家ID>]`
  * **示例**:
      * 将你的金币设为 `5000`: `/vex set player_money 5000`
      * 将服务器公告设为 `服务器维护中`: `/vex set server_motd 服务器维护中`
  * **注意**: 此操作会无视变量原来的内容，直接用新值覆盖，但依然会受到 `min`/`max` 的约束。

#### **3.4 全能增加/追加 (`add`)**

DrcomoVex 最强大的指令之一。它不仅智能，而且支持动态值。

  * **指令格式**: `/vex add <变量名> <要增加的值> [-p:<玩家ID>]`
  * **核心特性**:
    1.  **智能判断**:
          * 如果变量是**数值**，则执行**数学加法**。
          * 如果变量是**列表**，则执行**元素追加**。
          * 如果变量是**文本**，则执行**字符串拼接**。
    2.  **支持负数**:
          * 你可以使用负数来进行减法操作。例如 `/vex add player_money -50` 就等同于扣除 50 金币。
    3.  **支持占位符**:
          * `<要增加的值>` 这个参数**可以包含 PlaceholderAPI 占位符**！系统会在执行前自动解析。
  * **示例**:
      * 给你的金币增加 `100`: `/vex add player_money 100`
      * 扣除玩家 `Notch` 的 `10` 点积分: `/vex add player_points -10 -p:Notch`
      * 向你的称号列表添加新称号: `/vex add player_titles "无畏先锋"`
      * **高级用法**: 根据玩家等级给予奖励。假设某插件提供了 `%some_plugin_reward_amount%` 占位符，其值是 100：
        ```
        /vex add player_money %some_plugin_reward_amount%
        ```
        这条指令会为玩家增加 100 金币。

#### **3.5 智能移除/减少 (`remove`)**

`remove` 指令现在更加纯粹，专注于从列表和文本中“移除”内容。对于数值的减少，推荐使用 `add` 配合负数。

  * **指令格式**: `/vex remove <变量名> <要移除的值> [-p:<玩家ID>]`
  * **行为模式**:
    1.  **如果变量是列表**: 执行**元素移除**。
          * **示例**: `/vex remove player_titles "新手"`
    2.  **如果变量是文本**: 执行**子字符串移除**。
          * **示例**: `/vex remove server_motd "维护中"`

#### **3.6 重置变量 (`reset`)**

将变量**彻底恢复**到其在配置文件中定义的 `initial` 初始状态。这会**删除**该玩家关于此变量的所有自定义数据。

  * **指令格式**: `/vex reset <变量名> [-p:<玩家ID>]`
  * **示例**:
      * 重置你的每日任务计数: `/vex reset daily_task_count`
  * **与 `set` 的区别**: `set` 是覆盖为**你指定的值**，而 `reset` 是恢复为**配置文件里写好的初始值**。

#### **3.7 管理员操作 (`reload`)**

  * **指令格式**: `/vex reload`
  * **功能**: 重新加载所有配置文件 (`config.yml`, `variables.yml` 等)，使修改立即生效，无需重启服务器。

-----

### ⚙ 4. 配置与个性化

这部分是 DrcomoVex 的灵魂。**你的所有玩法，都在这里诞生。**

  * **配置文件路径**: `/plugins/DrcomoVEX/variables.yml`
  * **热重载**: 修改保存后，使用 `/vex reload` 立即生效。

#### **核心设计：智能推断，可选定义**

DrcomoVex 会首先尝试根据 `initial` 值的格式（是数字、是文本、还是列表）来**智能推断**变量的基础类型。同时，你可以**选择性地**使用 `type` 字段来**明确告诉**插件这个变量是什么，以便获得更精确的约束检查。

  * **有 `cycle` 字段** -\> 它就是**周期性变量**。
  * **`initial` 的值包含占位符** -\> 它就是**动态变量**。
  * **（推荐）使用 `type` 字段** -\> 插件将严格按照你定义的类型工作，并在加载时检查 `min`/`max` 等配置是否合理。

#### **完整配置字段清单**

| 字段名称 | 示例值 | 功能说明 |
| :--- | :--- | :--- |
| `name` | `"玩家金币"` | (可选) 变量的显示名称，未来可能用于 UI 或提示信息。 |
| `scope` | `"global"` 或 `"player"` | (可选) 变量作用域。`global`为全局共享，`player`为玩家私有。**默认值为 `player`**。 |
| `type` | `"INT"`, `"DOUBLE"`, `"STRING"`, `"LIST"` | (可选) **明确定义变量类型**。如果省略，插件会智能推断。推荐填写以获得更严格的检查。 |
| `initial` | `100` 或 `"Hello"` 或 `["a", "b"]` 或 `"%player_level% * 10"` | **(必需)** 变量的初始默认值。**它的内容决定了变量是否动态。** |
| `min` | `0` 或 `"%player_level% * 5"` | (可选) **智能约束**。对数值类型，是最小值；对列表类型，是最小长度。支持占位符。 |
| `max` | `10000` 或 `"%player_level% * 100"` | (可选) **智能约束**。对数值类型，是最大值；对列表类型，是最大长度。支持占位符。 |
| `cycle` | `"DAILY"` 或 `"WEEKLY"` 或 `"MONTHLY"` 或 `"YEARLY"` 或 Cron表达式 | (可选) **周期性重置**。只要配置了此项，该变量就会按周期自动 `reset`。 |

#### **`cycle` 周期说明**

| 周期值 | 重置时间 |
| :--- | :--- |
| `DAILY` | 每日 00:00 |
| `WEEKLY` | 每周一 00:00 |
| `MONTHLY` | 每月 1 号 00:00 |
| `YEARLY` | 每年 1 月 1 日 00:00 |
| Cron表达式 | (高级) 您可以提供一个标准的 Cron 表达式来实现任意复杂的定时重置。例如 `"0 0 12 * * ?"` 表示每天中午12点重置。 |

#### **终极配置示例 (`variables.yml`)**

```yaml
# DrcomoVEX - “终极直觉”配置文件
# 灵活与规范的完美结合。

variables:

  # 示例1: 玩家金币 (player_money)
  # 明确定义为 DOUBLE，插件会严格进行数值检查
  player_money:
    name: "金币"
    scope: "player"
    type: "DOUBLE"
    initial: 100.0
    min: 0
    max: "1000 + %player_level% * 500" # 金币上限随等级提升

  # 示例2: 每日在线奖励 (daily_reward_claimed)
  # 未定义 type，插件会推断为 STRING 类型
  daily_reward_claimed:
    name: "每日奖励领取状态"
    initial: "false"
    cycle: "DAILY" # 每天0点自动变回 "false"

  # 示例3: 玩家称号列表 (player_titles)
  # 明确定义为 LIST，插件会检查 min/max 是否用于限制列表长度
  player_titles:
    name: "玩家称号"
    type: "LIST"
    initial:
      - "冒险家"
    max: 5 # 最多只能拥有5个称号

  # 示例4: 玩家动态战斗力 (player_combat_power)
  # initial 的值是一个表达式，插件自动视其为动态变量
  player_combat_power:
    name: "战斗力"
    type: "DOUBLE" # 明确告知插件结果是数值，以便应用 min 约束
    initial: "(${player_level} * 10) + (${player_money} / 100)"
    min: 0

  # 示例5: 全局服务器公告 (server_motd)
  # 标准的全局文本变量
  server_motd:
    name: "服务器公告"
    scope: "global"
    type: "STRING"
    initial: "欢迎来到我们的服务器！"

```

-----

### ❗ 5. 错误提示与异常处理

| 系统提示信息 (示例) | 可能的原因 | 你该怎么办 |
| :--- | :--- | :--- |
| **[加载时警告]** `变量 'server_motd' 的类型为 STRING，不支持 min/max 约束，已忽略。` | 你为一个 `type` 为 `STRING` 的变量配置了 `min` 或 `max`。 | 这是插件的智能提示，告诉你这个约束无效。你可以忽略它，或者移除该变量的 `min`/`max` 配置。 |
| `操作失败: 尝试对文本变量 'server_motd' 执行数学运算。` | 你对一个明确或推断为 `STRING` 的变量使用了 `/vex add 10`。 | 确认你的操作目标是否正确。对 `STRING` 类型使用 `add` 会执行文本拼接。 |
| `操作失败: 值 5 超出了最小值约束 10。` | 你尝试将一个变量设置或减少到一个低于其 `min` 限制的值。 | 输入一个在 `min` 和 `max` 范围内的有效值。 |
| `操作失败: 列表已满 (最大容量: 5)。` | 你尝试向一个已达到 `max` 数量限制的列表变量添加新元素。 | 先移除一些旧元素，或者请管理员调整该变量的 `max` 配置。 |

-----

### 📊 6. 使用建议与最佳实践

  * **推荐填写 `type`**：虽然插件支持智能推断，但我们强烈建议您为变量（尤其是数值和列表类型）明确填写 `type` 字段。这不仅能让您的配置文件更具可读性，还能让插件在加载时就为您检查出潜在的配置错误（如对文本设置 `min` 值）。
  * **`add` 指令是你的瑞士军刀**：对于数值的增减，请优先使用 `/vex add` (配合正负数)，而不是先 `get` 再 `set`。它更简洁，并且支持直接使用占位符，可以轻松实现“击杀怪物后，根据怪物等级增加金币”这样的动态奖励。
  * **组合创造奇迹**：将动态变量、周期性变量和标准变量组合起来。例如，创建一个周期性的 `daily_kill_count`，再创建一个动态的 `daily_kill_bonus`，其 `initial` 表达式为 `${daily_kill_count} * 0.5`，这样玩家的每日击杀奖励就能自动计算了。

-----

### 📖 7. 快速参考表

#### **指令清单**

| 指令 | 核心功能 |
| :--- | :--- |
| `/vex get <变量> [-p:玩家]` | 实时获取值 |
| `/vex set <变量> <值> [-p:玩家]` | 强制覆盖值 |
| `/vex add <变量> <值> [-p:玩家]` | 智能增加（支持负数和占位符） |
| `/vex remove <变量> <值> [-p:玩家]` | 智能移除（列表/文本） |
| `/vex reset <变量> [-p:玩家]` | 恢复到初始值 |
| `/vex reload` | 重载配置 |

#### **配置项清单**

| 配置项 | 功能 | 备注 |
| :--- | :--- | :--- |
| `name` | 显示名称 | 可选 |
| `scope` | 作用域 (`player`/`global`) | 可选，默认为 `player` |
| `type` | 类型 (`INT`/`DOUBLE`/`STRING`/`LIST`) | 可选，推荐填写 |
| `initial` | **(核心)** 初始值/动态表达式 | 必需 |
| `min`/`max` | **智能约束**（值或长度） | 可选，支持占位符 |
| `cycle` | 周期性重置 | 可选 |

-----

### ❓ 8. FAQ 常见问题

  * **问：如果我不写 `type`，插件怎么知道 `player_money` 是个数字？**

      * 答：它会首先查看 `initial: 100.0`，发现这是个小数，于是**推断**它可能是 `DOUBLE`。当你执行 `/vex add player_money 50` 时，它会尝试进行数学运算，如果成功，就确认了它的数字“身份”。但如果你写了 `type: "DOUBLE"`，它在一开始就会把它当作数字，并严格检查后续操作。

  * **问：我可以在 `min` 或 `max` 里使用内部变量引用吗？比如 `max: "${some_other_variable} * 2"`？**

      * 答：是的，完全可以。DrcomoVex 的所有动态表达式解析都是统一的，你可以在 `initial`, `min`, `max` 中自由使用 PAPI 占位符和 `${内部变量}` 引用。

  * **问：`add` 指令和 `set` 指令都会被 `min`/`max` 限制吗？**

      * 答：是的。任何会改变变量值的操作（`set`, `add`）都会在执行后检查结果是否超出了 `min`/`max` 的约束。如果超出，操作将被判定为失败，并返回错误提示，变量的值不会被改变。

  * **问：我是一个开发者，我该如何与 DrcomoVex 交互？**

      * 答：本手册主要面向服务器管理员。关于开发者使用的 API 文档，我们将另行提供。请放心，DrcomoVex 同样为开发者设计了一套强大、稳定且完全异步的 API 接口，方便您在自己的插件中与 DrcomoVex 进行深度集成。